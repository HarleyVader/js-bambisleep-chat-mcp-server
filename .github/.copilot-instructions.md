# Copilot Instructions for MCP Server & Agent Docking Project

## Project Overview

This is a Model Context Protocol (MCP) server with agent docking capabilities. The project enables secure authentication, tool management, GitHub integration, and real-time communication between agents and the MCP server.

## 3-Step Development Strategy

When working on this project, follow this systematic approach:

### Step 1: Analysis & Planning
**Think about a solution after reading the #codebase then write development-plan.md file**

1. **Read the codebase thoroughly**
   - Examine existing file structure and dependencies
   - Understand current implementation state
   - Identify what's been completed vs. what needs work
   - Review any existing documentation

2. **Analyze the requirements**
   - Break down the user's request into specific technical requirements
   - Identify which components need to be created, modified, or integrated
   - Consider dependencies and prerequisites

3. **Plan the implementation**
   - Reference the DEVELOPMENT-PLAN.md for the overall roadmap
   - Determine which week/phase the current task belongs to
   - Plan the specific steps needed to implement the feature
   - Consider testing and validation requirements

### Step 2: Implementation
**Read #codebase & compare with development-plan.md then implement development-plan.md**

1. **Cross-reference with development plan**
   - Ensure the implementation aligns with the planned architecture
   - Follow the weekly milestones and key tools specified
   - Maintain consistency with the overall project structure

2. **Implement incrementally**
   - Start with core functionality
   - Add features in logical order based on dependencies
   - Test each component as you build it
   - Follow the project's coding standards and patterns

3. **Validate against milestones**
   - Ensure each implementation meets the defined milestone criteria
   - Test functionality works as expected
   - Verify integration with existing components

### Step 3: Completion Tracking
**Update completion-stats.md when done**

1. **Document what was completed**
   - Record which features were implemented
   - Note any deviations from the original plan
   - Document any new dependencies or configurations added

2. **Update project status**
   - Mark completed milestones
   - Update progress percentages for each week
   - Note any blockers or issues encountered

3. **Plan next steps**
   - Identify what needs to be done next
   - Update priorities based on current state
   - Note any technical debt or refactoring needs

## Project Structure & Key Components

### Week 1: Project Setup & Environment
- **Tools**: dotenv, cross-env, concurrently, nodemon
- **Goal**: Basic project structure with development workflow

### Week 2: Authentication & OAuth  
- **Tools**: passport, passport-github2, @oauth-everything/passport-patreon, express-session
- **Goal**: User authentication via GitHub and Patreon

### Week 3: MCP Core & Tool Management
- **Tools**: modelcontextprotocol, ajv, fs-extra, child_process
- **Goal**: Core MCP functionality with tool execution

### Week 4: GitHub Integration
- **Tools**: @octokit/rest, simple-git
- **Goal**: Git operations and GitHub API integration

### Week 5: Server Routing & Real-Time Communication
- **Tools**: express/koa, cors, body-parser, helmet, socket.io, eventsource
- **Goal**: HTTP server with WebSocket and SSE support

### Week 6: Persistence, Testing & Deployment
- **Tools**: sqlite3/pg/redis, sequelize/knex, jest, supertest, eslint, prettier, Docker
- **Goal**: Database, testing, and deployment infrastructure

## Development Guidelines

### Code Quality
- Use ESLint and Prettier for consistent formatting
- Follow the established project structure
- Write comprehensive tests for new functionality
- Document all public APIs and complex logic

### Security Considerations
- Never commit secrets or API keys
- Use environment variables for all configuration
- Follow OWASP guidelines for authentication and session management
- Validate all inputs and sanitize outputs

### Architecture Patterns
- **Monorepo Structure**: Separate server and agent codebases
- **Modular Design**: Each week's components should be loosely coupled
- **Event-Driven**: Use WebSocket/SSE for real-time communication
- **RESTful APIs**: Follow REST principles for HTTP endpoints

### Testing Strategy
- Unit tests for core logic
- Integration tests for API endpoints
- End-to-end tests for critical workflows
- Mock external dependencies (GitHub API, OAuth providers)

## Common Development Scenarios

### Adding a New MCP Tool
1. Define JSON schema in the MCP core module
2. Implement tool execution logic
3. Add validation using ajv
4. Write tests for the tool
5. Update tool registry

### Adding a New API Endpoint
1. Define route in appropriate module
2. Add input validation middleware
3. Implement business logic
4. Add error handling
5. Write integration tests

### Adding OAuth Provider
1. Install appropriate passport strategy
2. Configure strategy in auth module
3. Add callback routes
4. Update session handling
5. Test authentication flow

## File Organization

```
js-bambisleep-chat-mcp-server/
├── server/                 # MCP Server implementation
├── agent/                 # GitHub integration agent
├── shared/                # Shared utilities and types
├── docker/                # Docker configurations
├── DEVELOPMENT-PLAN.md    # This roadmap document
├── COMPLETION-STATS.md    # Progress tracking
└── .env.example          # Environment template
```

## Environment Variables

Ensure these are configured for development:

```bash
# OAuth Configuration
GITHUB_CLIENT_ID=your_github_client_id
GITHUB_CLIENT_SECRET=your_github_client_secret
PATREON_CLIENT_ID=your_patreon_client_id
PATREON_CLIENT_SECRET=your_patreon_client_secret

# Database
DATABASE_URL=sqlite://./dev.db

# Session
SESSION_SECRET=your_session_secret

# MCP Configuration
MCP_PORT=3001
AGENT_PORT=3002
```

## Common Commands

```bash
# Development
npm run dev          # Start both server and agent with hot-reload
npm run test         # Run all tests
npm run lint         # Lint all code
npm run format       # Format code with Prettier

# Production
npm run build        # Build for production
npm run start        # Start production server
docker-compose up    # Start with Docker
```

Remember: Always follow the 3-step strategy for any development work on this project!
